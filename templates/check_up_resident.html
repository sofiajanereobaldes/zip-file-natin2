{% extends "base.html" %} <!--jinja code-->

{%block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home_resident.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/check_up_resident.css') }}">
{%endblock%}

{% block header %}
<header class="header" id="mainHeader">
    <div class="header-left">
      <div class="logo">
            <img src="{{ url_for('static', filename='images/cares-high-resolution-logo-transparent (2).png') }}" alt="CARES logo" class="logo-image">
          </div>
      <div class="logo-text">
        <span>CARES</span>
      </div>
    </div>

    <nav class="nav">
      <a href="{{ url_for('homepage_bp.home_resident') }}" >Home</a>
      <a href="{{ url_for('announcement_bp.announcement') }}">Announcements</a>
      <a href="{{ url_for('checkup_bp.check_up_log_resident') }}" class="active">Check-Up Log</a>
    </nav>

    <div class="header-right">
  <div class="profile-chip" id="profileChip">
    <div class="avatar">{{ user.first_name[0] }}{{ user.last_name[0] }}</div>
    <div class="profile-info">
      <span class="name">{{ user.first_name }} {{ user.last_name }}</span>
      <span class="role">Resident ID: {{ user.resident_id }}</span>
    </div>
    <span class="chevron">‚ñæ</span>
  </div>

  <div class="profile-menu" id = "profile-menu">
    <ul>
      <li data-action="logout">Log Out</li>
    </ul>
  </div>
</div>
</header>
{% endblock %}

{% block content %}
<main>
    <button class="back-link" id="backBtn" data-home-url="{{ url_for('homepage_bp.home_resident') }}">‚Üê Back to Home</button>

    <div class="page-card">
      <div class="page-header-top">
        <div class="page-header-title">
          <div class="page-header-icon">üíö</div>
          <div class="page-header-text">
            <h1>My Health Records</h1>
            <p>View your medical history and schedule appointments</p>
          </div>
        </div>
        <div class="page-header-right" id="totalSummary"></div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" data-tab="history">History</button>
        <button class="tab" data-tab="appointment">Appointment</button>
      </div>

      <!-- HISTORY -->
      <div class="section-inner" id="section-history">
        <div class="history-header">
          <h2>Medical History</h2>
          <span id="totalRecords">Total Records: 0</span>
        </div>
        <div class="table-wrap" id="historyTableWrap">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Vitals</th>
                <th>Symptoms / Observation</th>
                <th>Prescription</th>
                <th>Doctor</th>
              </tr>
            </thead>
            <tbody id="historyBody">
              <!-- rows injected -->
            </tbody>
          </table>
        </div>
        <div class="loading" id="historyLoading">Loading medical history‚Ä¶</div>
      </div>

      <!-- APPOINTMENT -->
      <div class="section-inner hidden" id="section-appointment">
        <form id="appointmentForm" novalidate>
          <!-- Personal Information -->
          <div class="form-section">
            <h3>Personal Information</h3>
            <div class="form-grid">
              <div>
                <div class="field-label">Patient Name *</div>
                <input type="text" name="name" id="fieldName" required />
              </div>
              <div>
                <div class="field-label">Date of Birth *</div>
                <input type="date" name="dob" id="fieldDob" required />
              </div>
              <div>
                <div class="field-label">Age *</div>
                <input type="number" name="age" id="fieldAge" min="0" required />
              </div>
              <div>
                <div class="field-label">Gender *</div>
                <select name="gender" id="fieldGender" required>
                  <option value="">Select</option>
                  <option>Female</option>
                  <option>Male</option>
                  <option>Other</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Contact Information -->
          <div class="form-section">
            <h3>Contact Information</h3>
            <div class="form-grid">
              <div>
                <div class="field-label">Email *</div>
                <input type="email" name="email" id="fieldEmail" required />
              </div>
              <div>
                <div class="field-label">Phone *</div>
                <input type="tel" name="phone" id="fieldPhone" required />
              </div>
              <div>
                <div class="field-label">Address *</div>
                <input type="text" name="address" id="fieldAddress" required />
              </div>
              <div>
                <div class="field-label">Emergency Contact *</div>
                <input type="text" name="emergency" id="fieldEmergency" required />
              </div>
            </div>
          </div>

          <!-- Appointment Details -->
          <div class="form-section">
            <h3>Appointment Details</h3>
            <div class="form-grid">
              <div>
                <div class="field-label">Reason for Visit *</div>
                <textarea id="fieldReason" name="reason" maxlength="500" required></textarea>
                <div class="char-counter" data-counter-for="fieldReason">0 / 500</div>
              </div>
              <div>
                <div class="field-label">Appointment Type *</div>
                <select name="type" id="fieldType" required>
                  <option value="">Select appointment type</option>
                  <option>Routine Check-up</option>
                  <option>Follow-up Visit</option>
                  <option>Vaccination</option>
                  <option>Consultation</option>
                </select>
              </div>
              <div>
                <div class="field-label">Appointment Date *</div>
                <input type="date" name="date" id="fieldDate" required />
              </div>
              <div>
                <div class="field-label">Preferred Time *</div>
                <input type="time" name="time" id="fieldTime" required />
              </div>
              <div>
                <div class="field-label">Specific Condition and Symptoms</div>
                <textarea id="fieldSymptoms" name="symptoms" maxlength="500"></textarea>
                <div class="char-counter" data-counter-for="fieldSymptoms">0 />
                                500</div>
              </div>
            </div>
          </div>

          <!-- Health Information -->
          <div class="form-section">
            <h3>Health Information</h3>
            <div class="form-grid">
              <div>
                <div class="field-label">Medical History</div>
                <textarea id="fieldHistory" name="history" maxlength="500"></textarea>
                <div class="char-counter" data-counter-for="fieldHistory">0 / 500</div>
              </div>
              <div>
                <div class="field-label">Current Medications</div>
                <textarea id="fieldMeds" name="medications" maxlength="500"></textarea>
                <div class="char-counter" data-counter-for="fieldMeds">0 / 500</div>
              </div>
              <div>
                <div class="field-label">Lifestyle Habits</div>
                <textarea id="fieldLifestyle" name="lifestyle" maxlength="500"></textarea>
                <div class="char-counter" data-counter-for="fieldLifestyle">0 / 500</div>
              </div>
            </div>
          </div>

          <div class="form-footer">
            <button type="submit" class="btn-primary" id="btnSubmit">
              üìÖ Book Appointment
            </button>
          </div>
          <div id="formStatus" class="status-message"></div>
        </form>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-grid">
        <div>
          <h4>Emergency Contacts</h4>
          <p>Emergency<br />911</p>
          <p style="margin-top:6px;">Barangay Health<br />(02) 8765-4321</p>
          <p>City Health Office<br />(02) 8234-5678</p>
        </div>
        <div>
          <h4>Connect With Us</h4>
          <ul class="footer-list">
            <li>Facebook Page</li>
            <li>health@barangay.gov.ph</li>
            <li>Twitter Updates</li>
          </ul>
        </div>
        <div>
          <h4>Barangay Officials</h4>
          <ul class="footer-list">
            <li>Dr. Elena Rodriguez ‚Äì Barangay Health Officer</li>
            <li>Nurse John Martinez ‚Äì Community Health Nurse</li>
            <li>Ms. Carmen Silva ‚Äì Health Records Coordinator</li>
            <li>Dr. Michael Santos ‚Äì Visiting Physician</li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        ¬© 2025 Barangay Health Center. All rights reserved.
      </div>
    </div>
  </footer>
{% endblock %} 

{% block script %}
<script>
  const LOGOUT_URL = {{ url_for('api_logout') | tojson }};
  const LOGIN_OFFICIAL_URL = {{ url_for('login_bp.login', role='official') | tojson }};
</script>
<script src="{{ url_for('static', filename='scripts/check_up_resident.js') }}"></script>
{% endblock %}
